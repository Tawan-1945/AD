<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</title>

<link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/locales-all.min.js'></script>

<style>
body {
  font-family: 'Prompt', sans-serif;
  background: #fff;
  color: #c00;
  margin: 0;
  padding: 0;
}

header {
  background: #c00;
  color: #fff;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 20px;
  flex-wrap:wrap;
  position:sticky;
  top:0;
  z-index:10;
}
header .logo { font-weight:bold; font-size:18px; }
header nav a {
  color:#fff; background:#a00; padding:6px 14px;
  border-radius:6px; font-weight:bold; text-decoration:none;
  transition:0.3s; margin-left:8px;
}
header nav a:hover { background:#800; }

h2 { text-align:center; margin:15px 10px; color:#c00; font-size:20px; }
.search-box { max-width:1000px; margin:10px auto; text-align:right; padding:0 10px; }
.search-box input { padding:6px 10px; border:1px solid #c00; border-radius:6px; font-size:14px; width:220px; }

#calendar {
  max-width:1000px;
  margin:20px auto 40px auto;
  border:2px solid #c00;
  border-radius:12px;
  padding:10px;
  background:#fff;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
  min-height:500px;
}

.fc .fc-toolbar-title { color:#c00; font-weight:bold; font-size:18px; }
.fc .fc-daygrid-event {
  background:#c00 !important;
  color:#fff !important;
  border-radius:6px;
  padding:4px 6px;
  font-size:0.9em;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.fc .fc-button-primary { background:#c00; border:none; color:#fff; border-radius:6px; font-size:13px; padding:5px 10px; }
.fc .fc-button-primary:hover { background:#a00; }

footer { background:#c00; color:#fff; text-align:center; padding:12px 20px; font-size:14px; }

@media (max-width:600px){
  #calendar{padding:5px; min-height:400px;}
}
</style>
</head>
<body>

<header>
  <div class="logo">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</div>
  <nav><a href="login.html">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin</a></nav>
</header>

<h2>üìÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏≠‡∏≠‡∏Å‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</h2>
<div class="search-box">
  üîé <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà...">
</div>

<div id="calendar"></div>
<footer>¬© 2025 ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏≠‡∏≠‡∏Å‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô | AUTODIDACTIC</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

// ‡πÉ‡∏™‡πà Firebase Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á
const firebaseConfig = { /* ... */ };
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let allEvents = [];
let calendar;

document.addEventListener('DOMContentLoaded', async function(){
  const calendarEl = document.getElementById('calendar');
  
  calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: window.innerWidth < 600 ? 'listWeek' : 'dayGridMonth',
    locale: 'th',
    height: 'auto',  // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÉ‡∏´‡πâ responsive
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: window.innerWidth < 600 ? '' : 'dayGridMonth,listWeek'
    },
    eventContent: function(arg){
      let el = document.createElement('div');
      el.innerHTML = "<strong>"+arg.event.title+"</strong><br><small>"+(arg.event.extendedProps.location||"")+"</small>";
      return {domNodes:[el]};
    },
    eventClick: function(info){
      alert("‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô:\n‡∏ä‡∏∑‡πà‡∏≠: "+info.event.title+
            "\n‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: "+info.event.extendedProps.location+
            "\n‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°: "+info.event.startStr+
            "\n‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î: "+(info.event.endStr ? info.event.endStr.substr(0,10) : info.event.startStr));
    }
  });

  try {
    const snapshot = await getDocs(collection(db,"events"));
    snapshot.forEach(doc=>{
      const data = doc.data();
      allEvents.push({
        id: doc.id,
        title: data.title || "",
        start: data.start || "",
        end: data.end || "",
        location: data.location || ""
      });
    });
    calendar.addEventSource(allEvents);
    calendar.render();
  } catch(err){
    console.error("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Firebase ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", err);
    calendar.render();
  }

  // Search ‡πÅ‡∏ö‡∏ö real-time
  const searchInput = document.getElementById('searchInput');
  searchInput.addEventListener('input', function(){
    const query = this.value.toLowerCase().trim();
    if(query === "") {
      calendar.removeAllEventSources();
      calendar.addEventSource(allEvents);
      calendar.today(); // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    } else {
      const filtered = allEvents.filter(ev =>
        ev.title.toLowerCase().includes(query) ||
        (ev.location && ev.location.toLowerCase().includes(query))
      );
      calendar.removeAllEventSources();
      calendar.addEventSource(filtered);
      if(filtered.length > 0){
        calendar.gotoDate(filtered[0].start);
      }
    }
  });
});
</script>

</body>
</html>
